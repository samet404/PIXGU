var background=function(e){"use strict";function t(){let e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}function n(){return crypto.randomUUID()}function a(){const e=new Uint32Array(28);return crypto.getRandomValues(e),Array.from(e,(e=>("0"+e.toString(16)).slice(-2))).join("")}function r(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return null}}const o=[{langCode:"DE",langCodeForSpeech:"de-DE",supportsFormality:!0},{langCode:"EN-GB",langCodeForSpeech:"en",voice:"Google UK English Male"},{langCode:"EN-US",langCodeForSpeech:"en",voice:"Google UK English Male"},{langCode:"FR",langCodeForSpeech:"fr-FR",voice:"Thomas",supportsFormality:!0},{langCode:"ES",langCodeForSpeech:"es-ES",voice:"Google espaÃ±ol",label:"ES",supportsFormality:!0},{langCode:"IT",langCodeForSpeech:"it-IT",supportsFormality:!0},{langCode:"ID",langCodeForSpeech:"id-ID"},{langCode:"PL",langCodeForSpeech:"pl-PL",supportsFormality:!0},{langCode:"NL",langCodeForSpeech:"nl-NL",voice:"Google Nederlands",label:"NL",supportsFormality:!0},{langCode:"PT-PT",langCodeForSpeech:"pt-PT",supportsFormality:!0},{langCode:"PT-BR",langCodeForSpeech:"pt-PT",supportsFormality:!0},{langCode:"RU",langCodeForSpeech:"ru-RU",supportsFormality:!0},{langCode:"ZH",langCodeForSpeech:"zh-CN"},{langCode:"JA",langCodeForSpeech:"ja-JP",supportsFormality:!0},{langCode:"BG",langCodeForSpeech:"bg-BG"},{langCode:"CS",langCodeForSpeech:"cs-CZ"},{langCode:"DA",langCodeForSpeech:"da-DK"},{langCode:"ET",langCodeForSpeech:"et"},{langCode:"FI",langCodeForSpeech:"fi-FI",voice:"Satu"},{langCode:"EL",langCodeForSpeech:"el-GR"},{langCode:"HU",langCodeForSpeech:"hu-HU"},{langCode:"LV",langCodeForSpeech:"lv"},{langCode:"LT",langCodeForSpeech:"lt"},{langCode:"RO",langCodeForSpeech:"ro-RO"},{langCode:"SK",langCodeForSpeech:"sk-SK"},{langCode:"SL",langCodeForSpeech:"sl"},{langCode:"SV",langCodeForSpeech:"sv-SE"},{langCode:"TR",langCodeForSpeech:"tr-TR"},{langCode:"UK",langCodeForSpeech:"uk-UA"},{langCode:"NB",langCodeForSpeech:"nb-NO"},{langCode:"KO",langCodeForSpeech:"ko-KR"}],s=0,c="inline",i="automatic",l="manual",g="input",d=1,u=2,p=3,h=1500,m=5e3,T=1,y=2,f=3,E=1,w=2,L=1,_=2,I=3,S="HINT_KEYBOARD_SHORTCUT",C="INLINE_TRANSLATION_TRIGGER_ICON",A="INLINE_TRANSLATION_SETTINGS_ICON",D="INLINE_TRANSLATION_SETTING_POPUP",N="INPUT_TRANSLATION_TRIGGER_ICON",k="INPUT_TRANSLATION_SETTINGS_ICON",R="INPUT_TRANSLATION_SETTING_POPUP",b="SETTINGS_PAGE_FPT",O="SETTINGS_PAGE_READING",P="SETTINGS_PAGE_WRITING",v="FPT_HIDE_MODAL",x="INPUT_TRANSLATION_READ_MORE_LINK",U="INLINE_TRANSLATION_READ_MORE_LINK",F="FPT_TRANSLATION_READ_MORE_LINK",M="EXTENSION_HUB_TOGGLE_SWITCH",G="HUB_CUSTOMIZE_SHORTCUT",W="HUB_LOGIN_BUTTON",V="HUB_UPGRADE_TO_PRO_LINK",H="HUB_TRY_PRO_LINK",B="SETTINGS_PAGE_CUSTOMIZE_SHORTCUT_BUTTON",j="HUB_FPT_ENABLE_CHECKBOX",q="HUB_FPT_DISABLE_CHECKBOX",K="DEEPL_WRITE_ICON",X="gmailOnboardingPopup",$="gmailOnboardingIcon",Y="gmailCharLimitLogin",Z="gmailFeedbackSurvey",z="HUB_VIEW_INTEGRATIONS",J="HUB_CLOSE_CUSTOMIZATIONS_WIDGET",Q="trigger-translation",ee="change-language",te="CLICK_ON_SHORTCUT_NOTIFICATION",ne="CLICK_ON_INLINE_TRANSLATION_SHOW_ALTERNATIVES",ae="CLICK_ON_INLINE_TRANSLATION_CLOSE_ICON",re="CLICK_ON_LOGOUT_MENU_ENTRY",oe="DISABLE_PER_SITE",se="DISABLE_EVERYWHERE",ce="ENABLE_EVERYWHERE",ie="ENABLE_PER_SITE",le="INPUT_TRANSLATION",ge="INLINE_TRANSLATION",de="FULL_PAGE_TRANSLATION",ue=1,pe=2,he=3,me=4,Te="OPEN_PAGE",ye="BACK_BUTTON",fe="NEXT_BUTTON",Ee="NAVIGATION",we=0,Le=1,_e=2,Ie=3,Se="cofdbpoegempjloogbagkncekinflcnj",Ce="fancfknaplihpclbhbpclnmmjcjanbaf",Ae="ocpdpnakdghopjcifldjidbdmfobmmoi",De={deepl:1,linguee:2,google_translate:3,word_365:4,power_point_365:5,jira:6,confluence:7,gmail:8},Ne="DEFAULT",ke="GDOCS",Re="ZENDESK",be="WHATSAPP_WEB",Oe="TWITTER",Pe="GMAIL",ve="USER",xe="EXTENSION",Ue="OPEN_TICKET",Fe="DETECT_TICKET_LANGUAGE",Me="SWITCH_TICKET_LANGUAGE",Ge="ENABLE_AUTOTRANSLATE",We="DISABLE_AUTOTRANSLATE",Ve="TRANSLATE_MESSAGE",He="TRANSLATE_INPUT",Be="ERROR",je="TRANSLATION",qe="LOGIN",Ke="CHAT",Xe="MESSAGE",$e="free",Ye="pro",Ze="none",ze="TEXT_REFINEMENT_REQUEST",Je="GDOCS_INSERT_COPY",Qe="GDOCS_DISCARD_COPY",et="GDOCS_CHAR_LIMIT_REACHED",tt="RESULT_ACCEPTED",nt="RESULT_REVERTED",at="ERROR",rt="RESULT_ACCEPTED",ot="RESULT_REVERTED",st="READING_VIEW_TRANSLATE",ct="COMPOSE_VIEW_TRANSLATE",it="COMPOSE_VIEW_IMPROVE",lt="ANONYMOUS_USER_LIMIT_EXCEEDED",gt="FREE_ACCOUNT_LIMIT_EXCEEDED",dt="PRO_TRIAL",ut="LOGIN",pt="SIGNUP",ht={share_feedback_survey:"DOCS_GOOGLE_COM_FEEDBACK_FORM",new_share_feedback_survey:"NEW_FEEDBACK_FORM",try_DeepL_Pro:"DEEPL_COM_PRO",show_more_translation:"DEEPL_COM_TRANSLATOR",deepl_translator_home:"DEEPL_COM_HOMEPAGE",deepl_write_home:"DEEPL_COM_WRITE",deepl_translator_docs:"DEEPL_COM_DOCTRANS",shortcut_settings:"SHORTCUT_SETTINGS",support_article:"SUPPORT_ARTICLE",chrome_write_a_review:"CHROME_WRITE_A_REVIEW",edge_write_a_review:"EDGE_WRITE_A_REVIEW",gmail_feedback_survey:"GMAIL_FEEDBACK_SURVEY",external:{whatsapp:"EXTERNAL_WHATSAPP",twitter:"EXTERNAL_TWITTER",youtube:"EXTERNAL_YOUTUBE",facebook:"EXTERNAL_FACEBOOK",github:"EXTERNAL_GITHUB",discord:"EXTERNAL_DISCORD",telegram:"EXTERNAL_TELEGRAM",reddit:"EXTERNAL_REDDIT",gmail:"EXTERNAL_GMAIL",gdocs:"EXTERNAL_GDOCS"},deepl_support:"DEEPL_SUPPORT"},mt={DOCS_GOOGLE_COM_FEEDBACK_FORM:"https://deepl.typeform.com/to/MkMfP2Y6",NEW_FEEDBACK_FORM:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",DEEPL_COM_PRO:"https://www.deepl.com/pro",DEEPL_COM_TRANSLATOR:"https://www.deepl.com/translator",DEEPL_COM_WRITE:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.10.1",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.10.1",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.10.1",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.10.1",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",deeplPro:"https://www.deepl.com/pro",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW"}.deeplWrite,DEEPL_COM_DOCTRANS:"https://www.deepl.com/translator/files",SHORTCUT_SETTINGS:"chrome://extensions/shortcuts",SUPPORT_ARTICLE:"https://support.deepl.com/hc/articles/4407580229522",CHROME_WEBSTORE:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",EDGE_WEBSTORE:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",GMAIL_FEEDBACK_SURVEY:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW",EXTERNAL:{WHATSAPP:"https://web.whatsapp.com",TWITTER:"https://www.twitter.com",YOUTUBE:"https://www.youtube.com",FACEBOOK:"https://www.facebook.com",GITHUB:"https://www.github.com",DISCORD:"https://www.discord.com",TELEGRAM:"https://web.telegram.org",REDDIT:"https://www.reddit.com",GMAIL:"https://www.gmail.com",GDOCS:"https://docs.google.com"},DEEPL_SUPPORT:"https://support.deepl.com/hc"};function Tt(e){const{destination:t,...n}=e;if(void 0!==t)switch(t){case ht.share_feedback_survey:return mt.DOCS_GOOGLE_COM_FEEDBACK_FORM;case ht.new_share_feedback_survey:return mt.NEW_FEEDBACK_FORM;case ht.try_DeepL_Pro:return n?.utmContent?Et(mt.DEEPL_COM_PRO,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):mt.DEEPL_COM_PRO;case ht.show_more_translation:return n?function({sourceLang:e,targetLang:t,textToShare:n}){if(!e||!t||!n)return"";const a=new URL(mt.DEEPL_COM_TRANSLATOR);let r=`${e.toLowerCase()}/${t.toLowerCase()}/${encodeURIComponent(n)}`;return a.hash=r,a.href}(n):void console.error("Invalid action.");case ht.deepl_translator_home:return n?.utmContent?Et(mt.DEEPL_COM_TRANSLATOR,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):mt.DEEPL_COM_TRANSLATOR;case ht.deepl_write_home:return n?.utmContent?Et(mt.DEEPL_COM_WRITE,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):mt.DEEPL_COM_WRITE;case ht.deepl_translator_docs:return n?.utmContent?Et(mt.DEEPL_COM_DOCTRANS,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):mt.DEEPL_COM_DOCTRANS;case ht.shortcut_settings:return mt.SHORTCUT_SETTINGS;case ht.support_article:return mt.SUPPORT_ARTICLE;case ht.external.whatsapp:return mt.EXTERNAL.WHATSAPP;case ht.external.twitter:return mt.EXTERNAL.TWITTER;case ht.external.youtube:return mt.EXTERNAL.YOUTUBE;case ht.external.facebook:return mt.EXTERNAL.FACEBOOK;case ht.external.github:return mt.EXTERNAL.GITHUB;case ht.external.discord:return mt.EXTERNAL.DISCORD;case ht.external.telegram:return mt.EXTERNAL.TELEGRAM;case ht.external.reddit:return mt.EXTERNAL.REDDIT;case ht.external.gmail:return mt.EXTERNAL.GMAIL;case ht.external.gdocs:return mt.EXTERNAL.GDOCS;case ht.deepl_support:return mt.DEEPL_SUPPORT;case ht.chrome_write_a_review:return mt.CHROME_WEBSTORE;case ht.edge_write_a_review:return mt.EDGE_WEBSTORE;case ht.gmail_feedback_survey:return mt.GMAIL_FEEDBACK_SURVEY;default:return}}function yt(e){const t=Tt(e);console.log("redirectURL",t),t&&chrome.tabs.create({url:ft(t),active:!0})}function ft(e){return new URL(e).href}function Et(e,t){if(0===t.length||!e)return;const n=new URL(e);return t.forEach((e=>{2===e.length&&n.searchParams.append(e[0],e[1])})),n.href}const wt=()=>{let e=navigator.languages?navigator.languages[0].substr(0,2).toUpperCase():"EN";var t;e="EN"===(t=e)?"EN-GB":"PT"===t?"PT-PT":t;return o.map((e=>e.langCode)).includes(e)?e:"EN"},Lt=()=>{const e={};return o.forEach((t=>{let n=t.langCode;["EN-GB","EN-US"].includes(n)&&(n="EN"),["PT-PT","PT-BR"].includes(n)&&(n="PT"),e[n]=0})),e};const _t="production",It="development",St="testing";function Ct(){return _t}function At(){return Ct()===It}function Dt(e){chrome.runtime.sendMessage({action:"dlTrackError",errorMessage:e})}const Nt="PROTOCOL_ERROR",kt="FULL_PAGE_SERVER_ERROR",Rt="-32003",bt="403",Ot="ENTRY_NOT_FOUND",Pt="SERVER_ERROR",vt="INSTALLATION_ERROR",xt="TRANSLATED_INPUT_NOT_SET",Ut="FREE_ACCOUNT_LIMIT_EXCEEDED",Ft="ANONYMOUS_LIMIT_EXCEEDED";class Mt extends Error{constructor(e){super(e),this.name=Nt,this.message=e}}class Gt extends Error{constructor(e){super(e),this.name=kt,this.message=e}}class Wt extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}class Vt extends Error{constructor(e,t){super(t),this.name=Ut,this.limit=e,this.message=t}}class Ht extends Error{constructor(e,t){super(t),this.name=Ft,this.limit=e,this.message=t}}class Bt extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}function jt(e){try{Dt(`${e.name} ${e.message}`),console.error(e.name,e.message)}catch(e){console.error(e)}return{error:e.name}}function qt(){return{url:"https://s.deepl.com/chrome/statistics"}}function Kt(e){switch(e){case l:return 1;case i:return 2;case c:return 3;case g:return 4;default:return 0}}function Xt(e){switch(e){case Ot:return 1;case Pt:return 2}}function $t(e){switch(e){case T:return E;case y:return w;default:return 0}}function Yt(e){switch(e){case T:return L;case y:return _;case f:return I;default:return 0}}function Zt(e){return e===S?1:0}function zt(e){switch(e){case N:return 1;case C:return 2;case D:return 3;case R:return 4;case b:return 5;case O:return 6;case P:return 7;case v:return 8;case k:return 9;case A:return 10;case x:return 11;case U:return 12;case F:return 13;case M:return 14;case G:return 15;case W:return 16;case V:return 17;case H:return 18;case B:return 19;case j:return 20;case q:return 21;case K:return 22;case z:return 23;case J:return 24;case X:return 25;case $:return 26;case Y:return 27;case Z:return 28;default:return 0}}function Jt(e){return e===Q?1:0}function Qt(e){switch(e){case te:return 60011;case ne:return 60026;case ae:return 60027;case re:return 60028;default:return 0}}function en(e){switch(e){case le:return 1;case ge:return 2;case de:return 3;default:return 0}}function tn(e){switch(e){case se:return 1;case oe:return 2;case ce:return 3;case ie:return 4;default:return 0}}function nn(e){switch(e){case"top":return ue;case"right":return pe;case"bottom":return he;case"left":return me;default:return 0}}function an(e){switch(e){case ht.shortcut_settings:return mt.SHORTCUT_SETTINGS;case ht.support_article:return mt.SUPPORT_ARTICLE;case ht.external.whatsapp:return mt.EXTERNAL.WHATSAPP;case ht.external.twitter:return mt.EXTERNAL.TWITTER;case ht.external.youtube:return mt.EXTERNAL.YOUTUBE;case ht.external.facebook:return mt.EXTERNAL.FACEBOOK;case ht.external.github:return mt.EXTERNAL.GITHUB;case ht.external.discord:return mt.EXTERNAL.DISCORD;case ht.external.telegram:return mt.EXTERNAL.TELEGRAM;case ht.external.reddit:return mt.EXTERNAL.REDDIT;default:return""}}function rn(e){switch(e){case Te:return 1;case ye:return 2;case fe:return 3;case Ee:return 4;default:return 0}}function on(e){switch(e){case Se:return Le;case Ce:return _e;case Ae:return Ie;default:return we}}function sn(e){return De[e]||0}function cn(e){switch(e){case Ne:return 1;case ke:return 2;case be:return 3;case Oe:return 4;case Re:return 5;case Pe:return 6;default:return 0}}function ln(e){switch(e){case 60026:case 60027:return!0;default:return!1}}function gn(e){switch(e){case ve:return 1;case xe:return 2;default:return 0}}function dn(e){switch(e){case je:return 1;case qe:return 2;default:return 0}}function un(e){switch(e){case Xe:return 1;case Ke:return 2;default:return 0}}function pn(e){switch(e){case $e:return 1;case Ye:return 2;case Ze:return 3;default:return 0}}function hn(e){switch(e){case st:return 1;case ct:return 2;case it:return 3;default:return 0}}function mn(e){switch(e){case lt:return 1;case gt:return 2;default:return 0}}function Tn(e){switch(e){case ut:return 1;case pt:return 2;case dt:return 3;default:return 0}}const yn="Chrome",fn="Edge",En="Brave",wn="Firefox",Ln="Opera",_n="Safari";function In(e,t){let n;try{switch(e){case yn:case En:n=t.split("Chrome/")[1].split(" ")[0];break;case fn:n=t.split("Edg/")[1].split(" ")[0];break;case wn:n=t.split("Firefox/")[1].split(" ")[0];break;case Ln:n=t.split("OPR/")[1].split(" ")[0];break;case _n:n=t.split("Version/")[1].split(" ")[0]}}catch(t){console.error(`Could not get the browsers (${e}) version from user agent`,t)}try{!n&&navigator?.userAgentData&&function(e){return e===yn||e===fn||e===En||e===Ln}(e)&&(n=Sn(e).version)}catch(t){console.error(`Could not get the chromium browsers (${e}) version`,t)}return n&&"string"==typeof n?n:"unknown_browser_version"}function Sn(e){if(!navigator.userAgentData||!e)return;const t=new RegExp(`${e}`,"i");return navigator.userAgentData.brands.filter((e=>t.test(e.brand)))[0]}async function Cn(e){let t,n,a,r,o,s,c,i=!1;try{const e=await Ha(["session","installationId"]);n=e.session.id,t=e.installationId}catch(e){console.error(`DAP: Failed to fetch settings. Error: ${e.message}`)}try{const e=await nr();i=!!e.accountId,a=pn(e.translatorServiceType),r=pn(e.apiServiceType),o=pn(e.docTranslatorServiceType),c=i?2===a||2===r||2===o?u:p:d}catch(e){console.error(`DAP: Failed to fetch user information. Error: ${e.message}`)}try{s=await rr()}catch(e){console.error(e)}const l=function(){const e=navigator?.userAgent||"unknown_user_agent",t=navigator?.userAgentData?.platform||navigator?.platform||"unknown_platform";let n="unknown_browser",a="unknown_browser_version";const r=navigator?.language||"unknown_browser_language";try{const t=e.match(/chrome|chromium|crios/i),r=e.match(/edg/i)||Sn(fn),o=e.match(/firefox|fxios/i),s=e.match(/opr\//i)||Sn(Ln),c=e.match(/safari/i),i=Sn(En);t?(n=yn,r&&(n=fn),s&&(n=Ln),i&&(n=En)):r?n=fn:o?n=wn:s?n=Ln:c&&(n=_n),a=In(n,e)}catch(e){console.error("Could not get the name of the brower",e)}return{userAgent:e,platform:t,browser:n,browserVersion:a,browserLang:r}}(),g=await sr(),h={eventId:void 0,extensionVersion:"1.10.1",sessionId:n,installationId:t,browserInstanceId:s,originStore:on(chrome.runtime.id),userInfos:{userType:c,translatorServiceType:a,apiServiceType:r,docTranslatorServiceType:o},userAgent:l.userAgent,platform:l.platform,browser:l.browser,browserVersion:l.browserVersion,browserLang:l.browserLang,clientExperiments:g},m=e?e(h):h;return fetch("https://s.deepl.com/chrome/statistics",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(m)}).then((e=>{e.ok||console.log(`DAP ${m.eventId} request failed: ${e}`)}))}async function An(e){return Cn((t=>({...t,eventId:60001,translationRequestData:{extensionVersion:"1.10.1",domainName:e.domainName,userId:e.installationId,translationTrigger:Kt(e.trigger),translationData:{sourceLang:e.websiteLanguage,targetLang:e.targetLanguage,sourceLength:e.characterCount},...e.translationPerformance&&{translationPerformance:e.translationPerformance},nicheIntegration:cn(e.nicheIntegration||Ne)}})))}async function Dn(e){return Cn((t=>({...t,eventId:60002,errorData:{extensionVersion:"1.10.1",errorCode:e.errorCode,errorMessage:e.errorMessage}})))}async function Nn(e){return Cn((t=>({...t,eventId:60003,translationErrorData:{errorData:{extensionVersion:"1.10.1",errorCode:e.errorCode,errorMessage:e.errorMessage},targetLang:e.targetLang,domainName:e.domainName,websiteLanguage:e.websiteLanguage,sourceLength:e.characterCount,translationTrigger:Kt(e.trigger)}})))}async function kn(e){return Cn((t=>({...t,eventId:60004,contentScriptErrorData:{errorData:{extensionVersion:"1.10.1",errorCode:e.errorCode,errorMessage:e.errorMessage},domainName:e.domainName}})))}async function Rn(e){return Cn((t=>({...t,eventId:60005,inputInjectionData:{extensionVersion:"1.10.1",domainName:e.domainName}})))}async function bn(e){return Cn((t=>({...t,eventId:60007,extensionOpenedData:{extensionVersion:"1.10.1",domainName:e.domainName,extensionOpenedFrom:e.extensionOpenedFrom}})))}async function On(e){return Cn((t=>({...t,eventId:60008,logoClickedData:{extensionVersion:"1.10.1",logoClickedFrom:e.logoClickedFrom}})))}async function Pn(e){return Cn((t=>({...t,eventId:60009,notificationViewedData:{extensionVersion:"1.10.1",notificationType:Zt(e.notificationType)}})))}async function vn(e){return Cn((t=>({...t,eventId:60010,shortcutUsedData:{shortcutType:Jt(e.shortcutType),uiLocation:zt(e.location),shortcut:e.shortcut,nicheIntegration:cn(e.nicheIntegration||Ne)}})))}async function xn(e){const t={eventId:Qt(e.uiAction)};return ln(t.eventId)&&(t.payload={nicheIntegration:cn(e.nicheIntegration||Ne)}),Cn((e=>({...e,...t})))}async function Un(){return Cn((e=>({...e,eventId:60012})))}async function Fn(){return Cn((e=>({...e,eventId:60013})))}async function Mn(e){return Cn((t=>({...t,eventId:60014,inlineSettingOpenedData:{uiFunction:en(e.uiFunction),uiLocation:zt(e.uiLocation),nicheIntegration:cn(e.nicheIntegration)}})))}async function Gn(e){return Cn((t=>({...t,eventId:60015,settingChangedData:{settingType:tn(e.settingType),uiFunction:en(e.uiFunction),uiLocation:zt(e.uiLocation),domainName:e.domainName}})))}async function Wn(e){return Cn((t=>({...t,eventId:60016,detectLanguageData:{domainName:e.domainName,language:e.language}})))}async function Vn(e){return Cn((t=>({...t,eventId:60017,rightClickData:{domainName:e.domainName,translationType:e.translationType}})))}async function Hn(e){return Cn((t=>({...t,eventId:60018,inlinePositionChangeData:{newPosition:nn(e.newPosition)}})))}async function Bn(e){return Cn((t=>({...t,eventId:60019,inlineDragStartData:{nicheIntegration:cn(e?.nicheIntegration||Ne)}})))}async function jn(e){return Cn((t=>({...t,eventId:60020,whatsAppMessageTranslatedData:{messageLang:e.messageLang,targetLang:e.targetLang,messageLength:e.messageLength,translator:un(e.translator),numberOfLanguages:e.numberOfLanguages,numberOfMessages:e.numberOfMessages}})))}async function qn(e){return Cn((t=>({...t,eventId:60021,whatsAppMessageTranslationFailedData:{errorCode:e.errorCode,domainName:e.domainName,translationConfig:{messageLength:e.messageLength,targetLang:e.targetLang,messageLang:e.messageLang,translator:un(e.translator),numberOfLanguages:e.numberOfLanguages,numberOfMessages:e.numberOfMessages}}})))}async function Kn(e){return Cn((t=>({...t,eventId:60057,twitterTweetTranslationFailedData:{errorCode:e.errorCode,domainName:e.domainName,translationConfig:{messageLength:e.messageLength,targetLang:e.targetLang,messageLang:e.messageLang}}})))}async function Xn(e){return Cn((t=>({...t,eventId:60022,fptHideData:{hideOption:e.hideOption,sourceLang:e.sourceLang,domainName:e.domainName,uiLocation:zt(e.uiLocation)}})))}async function $n(e){return Cn((t=>({...t,eventId:60023,inlineCopyData:{targetLang:e.targetLang,targetLength:e.targetLength,nicheIntegration:cn(e.nicheIntegration||Ne)}})))}async function Yn(e){return Cn((t=>({...t,eventId:60024,inlineListenData:{targetLang:e.targetLang,targetLength:e.targetLength,actionType:e.actionType,nicheIntegration:cn(e.nicheIntegration||Ne)}})))}async function Zn(e){return Cn((t=>({...t,eventId:60025,iconHoverData:{uiLocation:zt(e.uiLocation),domainName:e.domainName,nicheIntegration:cn(e.nicheIntegration||Ne)}})))}async function zn(e){return Cn((t=>({...t,eventId:60029,onboardingStepChangeData:{previousStep:e.previousStep,newStep:e.newStep,trigger:rn(e.trigger),secondsOnOnboarding:e.secondsOnOnboarding,secondsOnPreviousStep:e.secondsOnPreviousStep}})))}async function Jn(e){return Cn((t=>({...t,eventId:60030,onboardingOpenExternalPageData:{url:an(e.url)}})))}async function Qn(e){return Cn((t=>({...t,eventId:60031,readMoreClickedData:{uiLocation:zt(e.uiLocation)}})))}async function ea(e){return Cn((t=>({...t,eventId:60032,landOnWebsiteData:{website:sn(e.website)}})))}async function ta(e){return Cn((t=>({...t,eventId:60033,inlineListenData:{targetLang:e.targetLang,targetLength:e.targetLength,triggerType:e.triggerType,nicheIntegration:cn(e.nicheIntegration||Ne)}})))}async function na(e){return Cn((t=>({...t,eventId:60034,openInputHighlighterData:{domainName:e.domainName}})))}async function aa(e){return Cn((t=>({...t,eventId:60035,closeInputHighlighterData:{trigger:e.trigger}})))}async function ra(e){return Cn((t=>({...t,eventId:60036,gdocsReplaceTextData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength,targetLength:e.targetLength}})))}async function oa(){return Cn((e=>({...e,eventId:60037})))}async function sa(e){return Cn((t=>({...t,eventId:60038,openInputHighlighterData:{domainName:e.domainName}})))}async function ca(e){return Cn((t=>({...t,eventId:60039,closeInputHighlighterData:{trigger:e.trigger}})))}async function ia(e){return Cn((t=>({...t,eventId:60040,dictionaryStatus:{status:e.status,langPair:e.langPair}})))}async function la(){return Cn((e=>({...e,eventId:60041})))}async function ga(){return Cn((e=>({...e,eventId:60042})))}async function da(e){return Cn((t=>({...t,eventId:60043,errorData:{lingueeError:Xt(e.error)}})))}async function ua(e,t){let n;switch(e){case Ue:n=60044;break;case Fe:n=60045;break;case Me:n=60046;break;case Ge:n=60047;break;case We:n=60048;break;case Ve:n=60049;break;case He:n=60050;break;case Be:n=60051;break;default:return}return Cn((e=>({...e,eventId:n,zendeskMetaData:{agentLanguage:t.agentLanguage,ticketLanguage:t.ticketLanguage,isTicketLanguageAutodetected:t.isTicketLanguageAutodetected,isTicketLanguageSupported:t.isTicketLanguageSupported,isAutoTranslateEnabled:t.isAutoTranslateEnabled,sourceTextLength:t.sourceTextLength,targetTextLength:t.targetTextLength,inputHasSelection:t.inputHasSelection,error:t.error}})))}async function pa(){return Cn((e=>({...e,eventId:60054})))}async function ha(e){const t=Math.round(await er()/60);return Cn((n=>({...n,eventId:60055,logoutData:{trigger:gn(e.trigger),minutesSinceLastLogin:t,reason:e.reason}})))}async function ma(e){return Cn((t=>({...t,eventId:60052,gdocsMaxCharExceededData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength}})))}async function Ta(e){return Cn((t=>({...t,eventId:60053,gdocsMaxCharExceededData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength}})))}async function ya(e){return Cn((t=>({...t,eventId:60056,sessionTypeData:{sessionType:e.sessionType,trigger:dn(e.trigger)}})))}async function fa(e){let t="";try{t=await Za()}catch(e){console.log(`DAP: Failed to fetch session type. Error: ${e.message}`)}return Cn((n=>({...n,eventId:60058,onboardingModalShownData:{nicheIntegration:cn(e.nicheIntegration||Ne),sessionType:t}})))}async function Ea(e){return Cn((t=>({...t,eventId:60059,UILocationClickedData:{target:zt(e)}})))}async function wa(){return Cn((e=>({...e,eventId:60060})))}async function La(){return Cn((e=>({...e,eventId:60061})))}async function _a(e,t){let n;switch(e){case ze:n=60062;break;case Je:n=60063;break;case Qe:n=60064;break;case et:n=60065;break;case at:n=60066;break;case tt:n=60071;break;case nt:n=60072;break;default:return}return Cn((e=>({...e,eventId:n,deeplWriteMetaData:{lang:t.lang,sourceLength:t.sourceLength,targetLength:t.targetLength,nicheIntegration:cn(t.nicheIntegration||Ne),error:t.error}})))}async function Ia(){if(!await $a())return;const e=await or();return Cn((t=>({...t,eventId:60067,accountData:{accountUuid:e}})))}async function Sa(){const e=await or();return Cn((t=>({...t,eventId:60068,accountData:{accountUuid:e}})))}async function Ca(){const e=await or();return Cn((t=>({...t,eventId:60069,accountData:{accountUuid:e}})))}async function Aa(e,t){let n;switch(e){case rt:n=60073;break;case ot:n=60074;break;default:return}return Cn((e=>({...e,eventId:n,translationResultActionData:{sourceLang:t.sourceLang,sourceLength:t.sourceLength,targetLength:t.targetLength,nicheIntegration:cn(t.nicheIntegration||Ne),error:t.error}})))}async function Da(e){return Cn((t=>({...t,eventId:60070,customizationOnOffData:{nicheIntegration:cn(e.nicheIntegration||Ne),uiLocation:zt(e.location),customizationEnabled:e.customizationEnabled}})))}async function Na(e){return Cn((t=>({...t,eventId:60075,gmailCharLimitReachedData:{gmailActionType:hn(e.type)}})))}async function ka(e){return Cn((t=>({...t,eventId:60076,upgradeNotificationDisplayedData:{type:mn(e)}})))}async function Ra(e){return Cn((t=>({...t,eventId:60077,upgradeNotificationClosedData:{type:mn(e)}})))}async function ba(e,t){return Cn((n=>({...n,eventId:60078,upgradeNotificationActionData:{type:mn(e),action:Tn(t)}})))}let Oa;const Pa="dlCache";function va(){return new Promise(((e,t)=>{let n=indexedDB.open("dlBrowserExtension",1);n.onerror=function(){t("Error creating database.")},n.onsuccess=function(t){Oa=t.target.result,e()},n.onupgradeneeded=function(t){Oa=t.target.result,Oa.objectStoreNames.contains(Pa)||Oa.createObjectStore(Pa,{keyPath:"id"}),e()}}))}async function xa(e,t,n){return Oa||await va(),new Promise(((a,r)=>{let o=Oa.transaction(n,"readwrite").objectStore(n).put({id:e,data:t,meta:{createdAt:Date.now()}});o.onsuccess=function(){a()},o.onerror=function(e){r(e)}}))}async function Ua(e,t){return Oa||await va(),new Promise(((n,a)=>{let r=Oa.transaction(t,"readonly").objectStore(t).get(e);r.onerror=function(e){a(e)},r.onsuccess=function(){r.result?n(r.result):n(null)}}))}function Fa(e){return xa("dlclientstate",e,Pa)}async function Ma(){const e=await Ua("dlclientstate",Pa);if(!e||!e.meta)return;return(Date.now()-e.meta.createdAt)/6e4>20?void 0:e.data}function Ga(e){return xa("dlexperiments",e,Pa)}async function Wa(){try{const e=await Ua("dlexperiments",Pa);return e&&e.meta&&e.data?e.data:[]}catch(e){return[]}}async function Va(){const e=await Ua("dlexperiments",Pa);if(!e||!e.meta)return;return(Date.now()-e.meta.createdAt)/6e4>9||!e.data||0===e.data.length?void 0:e.data}async function Ha(e){if(e.includes("session")){const e=await chrome.storage.sync.get(["session"]);e&&!e.session&&await Ba()}return new Promise(((t,n)=>{chrome.storage.sync.get(e,(a=>{a?t(a):n(`Can not get ${e}`)}))}))}async function Ba(){const e=n();await chrome.storage.sync.set({session:{id:e,timestamp:Date.now()}});try{await Ia()}catch(e){console.error(e)}}async function ja(){const{session:e}=await Ha(["session"]);!e||(Date.now()-e.timestamp)/6e4>30?await Ba():await chrome.storage.sync.set({session:{...e,timestamp:Date.now()}})}async function qa(e,t,n){const a=r(e);return await chrome.storage.local.set({a_t:e,r_t:t,i_t:n,isLoggedIn:!(!e||!t),isProUser:!(!a||"Pro"!==a.sessionType),sessionType:a?.sessionType}),a?.sessionType}async function Ka(){await chrome.storage.local.remove(["a_t","r_t","i_t"]),await chrome.storage.local.set({isLoggedIn:!1,isProUser:!1,sessionType:""})}async function Xa(){const e=await chrome.storage.local.get(["a_t","r_t","i_t"]);return{access_token:e?e.a_t:void 0,refresh_token:e?e.r_t:void 0,id_token:e?e.i_t:void 0}}async function $a(){const e=await chrome.storage.local.get(["isLoggedIn"]);return!(!e||!e.isLoggedIn)}async function Ya(){const e=await chrome.storage.local.get(["isProUser"]);return!(!e||!e.isProUser)}async function Za(){return(await chrome.storage.local.get(["sessionType"]))?.sessionType}async function za(){return(await chrome.storage.sync.get(["installationId"])).installationId}async function Ja(){await chrome.storage.local.set({last_login:Date.now()})}async function Qa(){await chrome.storage.local.remove(["last_login"])}async function er(){const e=await chrome.storage.local.get(["last_login"]);return e&&e.last_login?(Date.now()-e.last_login)/1e3:0}async function tr(e){const t=e.featureSet.translator.service,n=e.featureSet.api.service,a=e.featureSet.documentTranslation.service;let r,o;e.loginState?.accountId&&(r=e.loginState.accountId),e.featureSet?.integrations?.browserExtension&&(o=e.featureSet?.integrations?.browserExtension),await chrome.storage.local.set({translatorServiceType:t,apiServiceType:n,docTranslatorServiceType:a,accountId:r||"",featureSet:o})}async function nr(){return await chrome.storage.local.get(["isLoggedIn","isProUser","sessionType","translatorServiceType","apiServiceType","docTranslatorServiceType","accountId"])}async function ar(){await chrome.storage.local.set({browserInstanceId:n()})}async function rr(){return(await chrome.storage.local.get(["browserInstanceId"])).browserInstanceId}async function or(){const e=await chrome.storage.local.get(["accountId","a_t","i_t"]);if(e&&e.accountId)return e.accountId;if(e&&e.a_t){const t=r(e.a_t),n=r(e.i_t);return t.sub||n.sub}}async function sr(){let e=[];try{e=await Wa()}catch(e){}if(!e||0===e.length)return[];return e.map((e=>({id:e.id,variant:e.variant,breakout:e.breakout})))}async function cr(e="translatorServiceType"){const t=await nr(),n=!!t.accountId,a=t[e];return n?a===Ye?u:p:d}async function ir(e="translatorServiceType"){switch(await cr(e)){case p:return m;case u:return;default:return h}}async function lr(e=!1){if(!e){let e;try{e=await Va()}catch(e){}if(e)return e}const t=await za();let n=[];try{n=await Wa()}catch(e){}const a=`https://s.deepl.com/chrome/experiments/${t}`;let r;try{const e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify(n)});if(r=(await e.json()).client_experiments,!r)return n;try{Ga(r)}catch(e){}return r}catch(e){return n}}const gr="ACCESS_DENIED",dr="INVALID_REQUEST",ur="INVALID_GRANT",pr="GET_TOKEN_ERROR",hr="INVALID_NONCE";class mr extends Error{constructor(e,t){super(e),this.name=gr,this.message=e,this.httpStatusCode=t}}class Tr extends Error{constructor(e,t){super(e),this.name=dr,this.message=e,this.httpStatusCode=t}}class yr extends Error{constructor(e,t){super(e),this.name=ur,this.message=e,this.httpStatusCode=t}}class fr extends Error{constructor(e,t){super(e),this.name=pr,this.message=e,this.httpStatusCode=t}}class Er extends Error{constructor(e){super(e),this.name=hr,this.message=e}}function wr(e,t){const n=e.split("?")[1];if(n){var a=n.split("&");for(let e=0;e<a.length;e++){const n=a[e].split("=");if(decodeURIComponent(n[0])===t)return decodeURIComponent(n[1])}}}async function Lr(e,t,n="https://test.deepl.com/oidc-login"){const r=a(),o=a(),s=await async function(e){const t=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(o);return{url:n+"?"+new URLSearchParams([["client_id",e],["redirect_uri",t],["code_challenge",s],["code_challenge_method","S256"],["nonce",r]]),nonce:r,codeVerifier:o}}function _r(e,t){if(200!==e){if("invalid_request"===t.error)throw new Tr(`dl-oidc (get tokens): invalid request - http status: ${e}`,e);if("invalid_grant"===t.error)throw new yr(`dl-oidc (get tokens): invalid grant - http status: ${e}`,e);throw new fr(`dl-oidc (get tokens): http status: ${e}`,e)}}async function Ir(e,t="https://deepl.com/oidc/token"){const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})}),a=await n.json();return _r(n.status,a),a.access_token}async function Sr(e,t,n=!1){let a=t.access_token;async function r(){return await fetch(e,{...t,headers:{...t.headers,Authorization:a?`Bearer ${a}`:"None"}})}n&&a&&(a=await Ir(t.refresh_token,t.token_url));let o=await r();return 401!==o.status&&403!==o.status||(a=await Ir(t.refresh_token,t.token_url),o=await r()),{response:o,accessToken:a}}function Cr(e,t,n){return{jsonrpc:"2.0",method:e,params:t,id:n}}async function Ar(e=!1,n=!0){if(!e){const e=await Ma();if(e)return e}const a=Cr("getClientState",{v:"20180814"},t()),o=await Xa(),s=n||function(e){try{const t=r(e);if(t.exp&&Date.now()/1e3<t.exp-5)return!1}catch(e){console.error("Error decoding token:",e)}return!0}(o.access_token),{response:c,accessToken:i}=await Sr("https://w.deepl.com/web",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(a),access_token:o.access_token,refresh_token:o.refresh_token,token_url:"https://w.deepl.com/oidc/token"},s);await qa(i,o.refresh_token,o.id_token);const l=(await c.json()).result;return l&&(Fa(l),tr(l)),l}async function Dr(e=!1){const t=async()=>{const t=await Lr("chromeExtension",chrome.identity.getRedirectURL(),"https://www.deepl.com/auth/login");return new Promise(((n,a)=>{chrome.identity.launchWebAuthFlow({interactive:!0,url:e?`${t.url}#error_loginfailed`:t.url},(async e=>{if(!e){const e=chrome.runtime.lastError.message;return console.error("response url undefined",e),Dt(`login - response url undefined. ${e}`),/The user did not approve access/gm.test(e)?n():a()}try{const a=await async function(e,t,n,a,o,s="https://deepl.com/oidc/token"){const c=wr(n,"code");if(!c){const e=wr(n,"error");if("access_denied"===e)throw new mr("dl-oidc (get tokens): access denied - undefined code");if("invalid_request"===e)throw new Tr("dl-oidc (get tokens): invalid request - undefined code")}const i=await fetch(`${s}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:e,code_verifier:o,code:c,grant_type:"authorization_code",redirect_uri:t})}),l=await i.json();if(_r(i.status,l),r(l.id_token).nonce!==a)throw new Er("dl-oidc (get tokens): invalid nonce");return l}("chromeExtension",chrome.identity.getRedirectURL(),e,t.nonce,t.codeVerifier,"https://w.deepl.com/oidc/token"),o=await qa(a.access_token,a.refresh_token,a.id_token);try{await Ar(!0,!1),pa(),Sa(),o&&await ya({sessionType:o,trigger:"LOGIN"})}catch(e){console.error(e)}await Ja(),n()}catch(e){console.error(e);try{Dn({errorCode:e.name,errorMessage:e.message})}catch(e){console.error(e)}a(e)}}))}))};try{await t()}catch(e){Dr(!0)}}async function Nr(e){const t=await Xa(),n=`https://www.deepl.com/auth/logout?${new URLSearchParams([["id_token_hint",t.id_token],["post_logout_redirect_uri",chrome.identity.getRedirectURL()]])}`;chrome.identity.launchWebAuthFlow({url:n,interactive:!0},(async()=>{await Qa();try{await Ca()}catch(e){console.error(e)}await Ka();try{await ha({trigger:e.trigger,reason:e.reason})}catch(e){console.error(e)}await Ar(!0),e.showAlert&&chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{action:"dlShowAlert",payload:{error:e.reason}})}))}))}async function kr(e,t,n,a){const r=await Xa(),o=await Ya();let s=r&&r.access_token&&o?"https://api.deepl.com/jsonrpc?client=chrome-extension,1.10.1":"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.10.1";a&&(s=r&&r.access_token&&o?"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.10.1":"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.10.1");try{const{response:a,accessToken:o}=await Sr(s,{method:"POST",headers:{"Content-Type":t},body:e,access_token:r.access_token,refresh_token:r.refresh_token,token_url:"https://w.deepl.com/oidc/token"}),c=await qa(o,r.refresh_token,r.id_token);if(c)try{await ya({sessionType:c,trigger:"TRANSLATION"})}catch(e){console.log(e)}try{await Ar(!1,!1)}catch(e){console.error(`Failed to get the client state ${e.message}`)}let i=function(e,t,n){let a;try{a=JSON.parse(e)}catch(e){throw 200===t?new Mt("JSON_RPC: Parsing of response object failed"):t>=500&&n?new Gt(`FPT failed: Http status code ${t}`):new Wt(t.toString(),403===t?`Translation failed: Http status code ${t} forbidden request. re-authenticating makes no difference.`:`Translation failed: Http status code ${t}`)}if("2.0"!==a.jsonrpc||void 0!==a.result&&200!==t||void 0===a.result&&void 0===a.error)throw new Mt("JSON_RPC: missing field, wrong id, proper result without 200 status, or missing data");if(a.error){const e=a.error;if(void 0===e.code)throw new Mt('JSON_RPC: Missing field "code" in error response');throw new Wt(e.code.toString(),e.message)}if(200!==t)throw new Wt(t.toString(),`Http status code ${t}`);return a}(await a.text(),a.status,n);return{data:i,status:a.status}}catch(e){throw e.name!==gr&&e.name!==dr&&e.name!==ur&&e.name!==Rt&&e.name!==bt||setTimeout((()=>{Nr({trigger:xe,reason:e.name})}),5e3),e}}async function Rr(e,t,n=(e=>e),a,r,o){const s=function(e,t,n){return{jsonrpc:"2.0",method:e,params:t,id:n}}(e,t,a),c=n(JSON.stringify(s),s);return(await kr(c,"application/json; charset=utf-8",r,o)).data.result}async function br(e){let t,n={};for(const t in e.weights)e.weights[t]>0&&(n[t]=e.weights[t]);try{t=await cr()}catch(e){t=d,console.log(e)}if(t!==u&&e.nicheIntegration===Ne){const n=e.sourceTexts.reduce(((e,t)=>e+t.length),0),a=await ir();if(t===p&&n>a)throw new Vt(a,"Limit exceeded (free account). Please upgrade");if(t===d&&n>a)throw new Ht(a,"Limit exceeded (anonymous user). Please upgrade")}let a=e.sourceTexts;const r=["EN-US","EN-GB","PT-PT","PT-BR"].includes(e.targetLangCode?.toUpperCase());let o=e.targetLangCode?.toUpperCase();r&&(o=e.targetLangCode?.toUpperCase().slice(0,2));const s={texts:e.isWriteRequest?e.sourceTexts.map((e=>({text:e,requestAlternatives:4}))):a.map((e=>({text:e}))),...e.isHtml&&{html:"enabled"},...!e.isHtml&&{splitting:e.splitting?e.splitting:"paragraphs"},lang:{target_lang:o,source_lang_user_selected:"auto"===e.sourceLang?"auto":e.sourceLang.toUpperCase(),preference:{weight:n}},commonJobParams:{regionalVariant:e.regionalVariant&&r?e.regionalVariant:void 0,...e.isWriteRequest&&{mode:"write"},...e.formality&&{formality:e.formality}}};let c=1;const i=Date.now();a.forEach((e=>c+=(e.match(/[i]/g)||[]).length)),s.timestamp=i-i%c+c;const l=await Rr("LMT_handle_texts",s,((e,t)=>e=(t.id+3)%13==0||(t.id+5)%29==0?e.replace('"method":"','"method" : "'):e.replace('"method":"','"method": "')),e.id,e.isHtml,e.isWriteRequest);return{texts:l.texts.map((e=>e.text)),sourceLang:l.lang.toUpperCase(),detectedLanguages:l.detectedLanguages}}const Or=new Map([["ZH_EN","chinese-english"],["EN_ZH","english-chinese"],["NL_EN","dutch-english"],["EN_NL","english-dutch"],["FR_EN","french-english"],["EN_FR","english-french"],["FR_DE","french-german"],["DE_FR","german-french"],["FR_PT","french-portuguese"],["PT_FR","portuguese-french"],["FR_ES","french-spanish"],["ES_FR","spanish-french"],["DE_EN","german-english"],["EN_DE","english-german"],["DE_PT","german-portuguese"],["PT_DE","portuguese-german"],["DE_ES","german-spanish"],["ES_DE","spanish-german"],["IT_EN","italian-english"],["EN_IT","english-italian"],["JA_EN","japanese-english"],["EN_JA","english-japanese"],["PL_EN","polish-english"],["EN_PL","english-polish"],["PT_EN","portuguese-english"],["EN_PT","english-portuguese"],["PT_ES","portuguese-spanish"],["ES_PT","spanish-portuguese"],["RU_EN","russian-english"],["EN_RU","english-russian"],["ES_EN","spanish-english"],["EN_ES","english-spanish"]]);async function Pr(e){const t=function(e,t){const n=`${e.toUpperCase()}_${t.toUpperCase()}`;return Or.get(n)}(vr(e.sourceLang),vr(e.targetLang)),n=encodeURIComponent(e.text),a=`https://www-app.linguee.com/${t}/search?dlApp=BrowserExtension&il=${e.interfaceLang}&query=${n}`;let r=async function(e){let t;if(200!==e.status)throw 404===e.status?(console.error("Dictionary Entry not found: 404"),new Bt(Ot)):(console.error("Dictionary Server Error"),new Bt(Pt));{try{t=await e.text()}catch(e){throw new Bt(Pt)}const n=/href=["']([^"']*)["']/g;t=t.replace(n,"")}return t}(await fetch(a));return r}function vr(e){return["EN-US","EN-GB","PT-PT","PT-BR"].includes(e)?["EN-US","EN-GB"].includes(e)?"EN":["PT-PT","PT-BR"].includes(e)?"PT":e:e}function xr(e,t){const n=1e-5;return n*Math.floor((.97*e+t)/n)}async function Ur(e){const t=await Ha(["selectedTargetLanguage"]);chrome.tabs.sendMessage(e,{action:"dlTranslateInline",targetLang:t.selectedTargetLanguage})}async function Fr(e){await ja();const n=await Ha(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=new Date,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),isHtml:!0,sourceTexts:e.payload.texts,regionalVariant:n.regionalVariant};let o;try{o=await br(r)}catch(t){try{Nn({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,websiteLanguage:e.payload.sourceLang,trigger:e.payload.trigger,characterCount:e.payload.texts.reduce(((e,t)=>e+t.length),0)})}catch(e){console.log(e)}throw t}_o();const s={isFirstTime:e.payload.isFirstTime,processingTimeInMs:new Date-a};try{An({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.sourceLang,targetLanguage:n.selectedTargetLanguage,characterCount:e.payload.texts.reduce(((e,t)=>e+t.length),0),translationPerformance:s,domainName:e.payload.domainName})}catch(e){console.error(e)}return o.texts}async function Mr(e){await ja();const n=await Ha(["selectedTargetLanguage","session","installationId","languagePreferenceForReading","regionalVariant"]),a=e.payload.nicheIntegration||Ne,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:e.payload.requests.map((e=>e.text)),weights:n.languagePreferenceForReading,splitting:"newlines",regionalVariant:n.regionalVariant,nicheIntegration:a};let o;try{o=await br(r)}catch(t){try{Nn({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,websiteLanguage:e.payload.sourceLang,trigger:e.payload.trigger,characterCount:e.payload.requests.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}_o();try{if(o.detectedLanguages){for(const e in o.detectedLanguages)(n.languagePreferenceForReading[e]||0===n.languagePreferenceForReading[e])&&(n.languagePreferenceForReading[e]=xr(n.languagePreferenceForReading[e],o.detectedLanguages[e]));chrome.storage.sync.set({languagePreferenceForReading:n.languagePreferenceForReading})}}catch(e){console.error(e)}try{An({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.sourceLang,targetLanguage:n.selectedTargetLanguage,characterCount:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:a})}catch(e){console.error(e)}return o.texts.map((e=>({text:e,detected_source_language:o.sourceLang})))}async function Gr(e){await ja();const n=await Ha(["targetLanguageUserInput","session","installationId","languagePreferenceForWriting","regionalVariant"]),a=e.payload.requests,r=e.payload.targetLang||n.targetLanguageUserInput,o=e.payload.platformBehavior||Ne,s={sourceLang:"auto",targetLangCode:r,sessionId:n.session.id,id:t(),sourceTexts:a.map((e=>e.text))||[],weights:n.languagePreferenceForWriting,splitting:"paragraphs",regionalVariant:n.regionalVariant,nicheIntegration:o,...e.payload.isHtml&&{isHtml:e.payload.isHtml},...e.payload.formality&&{formality:e.payload.formality}};let c;try{c=await br(s)}catch(t){try{Nn({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:r,websiteLanguage:e.payload.websiteLanguage,trigger:g,characterCount:a.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}if(_o(),e.payload.platformBehavior===Pe&&jo(),c.sourceLang===n.targetLanguageUserInput&&a[0].text.length>15){let e;if("EN"===r)e="DE";else e="EN";let n=await br({...s,targetLangCode:e,id:t()});const a=await br({...s,sourceTexts:n.texts,id:t()});c.texts=a.texts}try{if(c.detectedLanguages){for(const e in c.detectedLanguages)(n.languagePreferenceForWriting[e]||0===n.languagePreferenceForWriting[e])&&(n.languagePreferenceForWriting[e]=xr(n.languagePreferenceForWriting[e],c.detectedLanguages[e]));chrome.storage.sync.set({languagePreferenceForWriting:n.languagePreferenceForWriting})}}catch(e){console.error(e)}if(!0!==e.payload.skipDapReporting)try{An({installationId:n.installationId,trigger:g,websiteLanguage:c.sourceLang,targetLanguage:r,characterCount:a.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:o})}catch(e){console.error(e)}return[{detected_source_language:c.sourceLang,text:c.texts[0],texts:c.texts}]}async function Wr(e){await ja();const n=await Ha(["targetLanguage","session","installationId","regionalVariant"]),a=e.payload.requests,r=e.payload.sourceLang,o=e.payload.targetLang||n.targetLanguage,s=Pe,c={sourceLang:r||"auto",targetLangCode:o,sessionId:n.session.id,id:t(),sourceTexts:a.map((e=>e.text))||[],splitting:"newlines",regionalVariant:n.regionalVariant};let i;try{i=await br(c)}catch(t){try{Nn({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:o,trigger:g,characterCount:a.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}_o(),jo();try{An({installationId:n.installationId,trigger:l,websiteLanguage:i.sourceLang,targetLanguage:o,characterCount:a.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:s})}catch(e){console.error(e)}return[{detected_source_language:i.sourceLang,text:i.texts[0],texts:i.texts}]}async function Vr(e){await ja();const n=await Ha(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=e.payload.message,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:[a],splitting:"paragraphs",regionalVariant:n.regionalVariant};let o;try{o=await br(r)}catch(t){try{Kn({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:a.length})}catch(e){console.log(e)}throw t}_o();try{An({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:n.selectedTargetLanguage,characterCount:a.length,domainName:e.payload.domainName,nicheIntegration:Oe})}catch(e){console.error(e)}return[{detected_source_language:o.sourceLang,text:o.texts[0]}]}async function Hr(e){await ja();const n=await Ha(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=e.payload.message,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:[a],splitting:"paragraphs",regionalVariant:n.regionalVariant};let o;try{o=await br(r)}catch(t){try{qn({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:a.length,numberOfLanguages:1,numberOfMessages:1,translator:Xe})}catch(e){console.log(e)}throw t}_o();try{jn({messageLang:e.payload.messageLang,targetLang:n.selectedTargetLanguage,messageLength:a.length,numberOfLanguages:1,numberOfMessages:1,translator:Xe}),An({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:n.selectedTargetLanguage,characterCount:a.length,domainName:e.payload.domainName,nicheIntegration:be})}catch(e){console.error(e)}return[{detected_source_language:o.sourceLang,text:o.texts[0]}]}async function Br(e){await ja();const n=await Ha(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=e.payload.messages,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:a,splitting:"paragraphs",regionalVariant:n.regionalVariant};let o;try{o=await br(r)}catch(t){try{qn({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:a.reduce(((e,t)=>e+t.length),0),numberOfLanguages:e.payload.detectedLanguages?.length,numberOfMessages:a.length,translator:Ke})}catch(e){console.log(e)}throw t}_o();try{jn({messageLang:e.payload.messageLang,targetLang:n.selectedTargetLanguage,messageLength:a.reduce(((e,t)=>e+t.length),0),numberOfLanguages:e.payload.detectedLanguages?.length,numberOfMessages:a.length,translator:Ke}),An({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:n.selectedTargetLanguage,characterCount:a.reduce(((e,t)=>e+t.length),0),domainName:e.payload.domainName,nicheIntegration:be})}catch(e){console.error(e)}return[{detected_source_language:o.sourceLang,texts:o.texts}]}async function jr(e){await ja();const n=await Ha(["session","installationId","regionalVariant"]),{sourceLang:a,targetLang:r,text:o,trigger:s}=e.payload;let c,i="";const l={sourceLang:a,targetLangCode:r,sessionId:n.session.id,id:t(),sourceTexts:[o],splitting:"paragraphs",regionalVariant:n.regionalVariant};let g;try{g=await br(l),i=g.texts?.[0]||""}catch(e){c=e.message}_o();try{An({installationId:n.installationId,trigger:s,websiteLanguage:a,targetLanguage:r,characterCount:o.length,nicheIntegration:Re})}catch(c){console.error(c)}return[i,c]}async function qr(e){try{Wn({language:e.payload.language,domainName:e.payload.domainName})}catch(e){console.error(e)}}async function Kr(e){try{Rn({domainName:e})}catch(e){console.error(e)}}async function Xr(e){try{bn({domainName:e.domainName,extensionOpenedFrom:$t(e.extensionContext)})}catch(e){console.error(e)}}async function $r(e){try{On({logoClickedFrom:Yt(e.extensionContext)})}catch(e){console.error(e)}}async function Yr(){try{Un()}catch(e){console.error(e)}}async function Zr(){try{Fn()}catch(e){console.error(e)}}async function zr(e){try{Mn({uiFunction:e.uiFunction,uiLocation:e.uiLocation,nicheIntegration:e.nicheIntegration||Ne})}catch(e){console.error(e)}}async function Jr(e){try{Gn({settingType:e.settingType,newValue:e.newValue,uiFunction:e.uiFunction,uiLocation:e.uiLocation,domainName:e.domainName})}catch(e){console.error(e)}}async function Qr(e){try{Vn({translationType:e.translationType,domainName:e.domainName})}catch(e){console.error(e)}}async function eo(e){try{Hn({newPosition:e.newPosition})}catch(e){console.error(e)}}async function to(e){try{Bn(e)}catch(e){console.error(e)}}async function no(e){try{Xn(e)}catch(e){console.error(e)}}async function ao(e){try{Zn(e)}catch(e){console.error(e)}}async function ro(e){try{$n(e)}catch(e){console.error(e)}}async function oo(e){try{zn(e)}catch(e){console.error(e)}}async function so(e){try{Yn(e)}catch(e){console.error(e)}}async function co(e){try{ta(e)}catch(e){console.error(e)}}async function io(e){try{Jn(e)}catch(e){console.error(e)}}async function lo(e){try{Qn(e)}catch(e){console.error(e)}}async function go(e){try{ra(e)}catch(e){console.error(e)}}async function uo(e=!1){const t=await lr(e);return chrome.runtime.sendMessage({action:"dlExperimentsUpdated",payload:{experiments:[...t]}}),t}async function po(){Dr()}async function ho(){Nr({trigger:ve})}async function mo(){return{isLoggedIn:await $a(),isProUser:await Ya()}}async function To(e){switch(e.type){case S:{const e=await chrome.storage.sync.get(["notificationsViewed"]);if(e.notificationsViewed&&e.notificationsViewed.hintKeyboardShortcut)return;await chrome.storage.sync.set({notificationsViewed:{...e.notificationsViewed,hintKeyboardShortcut:!0}});break}}try{Pn({notificationType:e.type})}catch(e){console.error(e)}const t=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(t[0].id,{action:"dlShowNotification",payload:e})}async function yo(){return await chrome.commands.getAll()}async function fo(e){const t=await yo();try{vn({shortcutType:e.shortcutType,location:e.location,shortcut:t.filter((t=>t.name===e.shortcutType))[0].shortcut,nicheIntegration:e.nicheIntegration||Ne})}catch(e){console.error(e)}}async function Eo(e){xn({uiAction:e.uiAction,nicheIntegration:e.nicheIntegration||Ne})}function wo(e){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{action:"dlTranslateSelectionRightClick",payload:e})}))}async function Lo(e){try{ea(e)}catch(e){console.error(e)}}async function _o(){const e=await chrome.storage.sync.get(["isReviewPopupShown","successfulTranslations"]),t=e.successfulTranslations+1;let n=e.isReviewPopupShown;if(!n&&t>=5){const e=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(e[0].id,{action:"dlShowAskForAReviewPopup"}),n=!0}await chrome.storage.sync.set({isReviewPopupShown:n,successfulTranslations:t})}async function Io(e,t){let n=(e=>{let t=o.find((t=>t.langCode.toUpperCase()===e.toUpperCase()));return t||(t=o.find((t=>t.langCode.substring(0,2).toUpperCase()===e.substring(0,2).toUpperCase())),t)})(e.lang);const a={lang:n.langCodeForSpeech,onEvent:function(e){"end"===e.type&&chrome.tabs.sendMessage(t,{action:"dlVoiceOverStopped"}),"error"==e.type&&chrome.tabs.sendMessage(t,{action:"dlVoiceOverErrorOccurred"})}};(function(){const e=navigator?.userAgentData?.platform||navigator?.platform||void 0;return e&&-1!==e?.toUpperCase().indexOf("MAC")})()&&(a.rate=.9,n.voice&&Se===chrome.runtime.id&&(a.voiceName=n.voice)),await chrome.tts.speak(e.text,a)}async function So(){return(await chrome.tts.getVoices()).map((e=>e.lang.substring(0,2).toUpperCase()))}async function Co(){return chrome.tts.stop()}async function Ao(e){try{na(e)}catch(e){console.error(e)}}async function Do(e){try{sa(e)}catch(e){console.error(e)}}async function No(e){try{aa(e)}catch(e){console.error(e)}}async function ko(e){try{ca(e)}catch(e){console.error(e)}}async function Ro(e){return await Pr(e)}async function bo(e){try{ia(e)}catch(e){console.error(e)}}async function Oo(e){try{la()}catch(e){console.error(e)}}async function Po(e){try{ga()}catch(e){console.error(e)}}async function vo({eventType:e,zendeskMetaData:t}){try{ua(e,t)}catch(e){console.error(e)}}async function xo(e){try{da(e)}catch(e){console.error(e)}}async function Uo(e){try{ma(e)}catch(e){console.error(e)}}async function Fo(e){try{Ta(e)}catch(e){console.error(e)}}async function Mo(e){try{fa(e)}catch(e){console.error(e)}}async function Go(e){try{Ea(e)}catch(e){console.error(e)}}async function Wo({eventType:e,deeplWriteMetaData:t}){try{_a(e,t)}catch(e){console.error(e)}}async function Vo(e){await ja();const n=await Ha(["selectedTargetLanguage","session"]),a=e.payload.requests,r={sourceLang:e.payload?.sourceLang?e.payload.sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:a.map((e=>e.text))||[],isWriteRequest:!0,...e.payload.isHtml&&{isHtml:!0}};let o;return o=await br(r),[{detected_source_language:o.sourceLang,text:o.texts[0],texts:o.texts}]}async function Ho({eventType:e,acceptOrRevertMetadata:t}){try{Aa(e,t)}catch(e){console.error(e)}}async function Bo(e){try{Da(e)}catch(e){console.error(e)}}async function jo(){const e=await chrome.storage.sync.get(["wasGmailFeedbackPopupShown","successfulTranslationsGmail"]),t=e.successfulTranslationsGmail+1;let n=e.wasGmailFeedbackPopupShown;if(!n&&t>=10){const e=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(e[0].id,{action:"dlShowGmailFeedbackPopup"}),n=!0}await chrome.storage.sync.set({wasGmailFeedbackPopupShown:n,successfulTranslationsGmail:t})}async function qo(e){try{Na(e)}catch(e){console.error(e)}}async function Ko(e=!1,t=!0){let n;try{n=await Ar(e,t)}catch(e){throw e.name===ur&&Nr({trigger:xe,reason:e.name,showAlert:!0}),e}return n}async function Xo(){return await ir()}function $o(e){try{ka(e)}catch(e){console.error(e)}}function Yo(e){try{Ra(e)}catch(e){console.error(e)}}function Zo(e,t){try{ba(e,t)}catch(e){console.error(e)}}const zo={syncExperiments:"sync_experiments",syncClientState:"sync_client_state"};function Jo(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}const Qo={developer_tools:"DEVELOPER_TOOLS",settings_page:"SETTINGS_PAGE",settings_writing:"SETTINGS_WRITING",settings_reading:"SETTINGS_READING",settings_customizations:"SETTINGS_CUSTOMIZATIONS",onboarding:"ONBOARDING"},es="dev-page.html",ts="settings.html",ns="settings.html#inline-translation",as="settings.html#input-translation",rs="settings.html#customizations",os="onboarding.html";function ss({payload:e}){const{destination:t}=e;if(void 0===t)return;let n="";switch(t){case Qo.developer_tools:n=cs(es);break;case Qo.settings_page:n=cs(ts);break;case Qo.settings_writing:n=cs(as);break;case Qo.settings_reading:n=cs(ns);break;case Qo.settings_customizations:n=cs(rs);break;case Qo.onboarding:n=cs(os)}n&&chrome.tabs.create({url:n,active:!0})}function cs(e){return chrome.runtime.getURL(e)}function is(e,t,n){switch(At()&&console.log(t.tab?`message from a content script: ${t.tab.url} with tab id: ${t.tab.id}. action: ${e.action}`:`message from the extension with action: ${e.action}`),e.action){case"dlRequestHtmlTranslation":Fr(e).then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlRequestInlineTranslation":Mr(e).then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlTriggerTranslateInline":Ur(t.tab.id);break;case"dlRequestInputTranslation":Gr(e).then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlRequestGmailReceivedEmailTranslation":Wr(e).then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlRequestWhatsAppMessageTranslation":Hr(e).then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlRequestTwitterTweetTranslation":Vr(e).then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlRequestZendeskMessageTranslation":jr(e).then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlRequestWhatsAppMessagesTranslation":Br(e).then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlTrackDetectLanguage":qr(e),n();break;case"dlRequestLogin":po().then((()=>n(!0))).catch((e=>{n(jt(e))}));break;case"dlRequestLogout":ho().then((()=>n(!0))).catch((e=>{n(jt(e))}));break;case"dlGetAppSettings":chrome.storage.sync.get(null,(function(e){n(e)}));break;case"dlUpdateAppSettings":chrome.storage.sync.set(e.payload,(function(){n(e.payload)}));break;case"dlTranslatedInputTextNotSet":kn({errorCode:xt,errorMessage:"The translated text could not be set",domainName:e.payload}),n();break;case"dlGetUserState":mo().then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlExternalURLRedirect":yt(e.payload),n();break;case"dlOpenInternalPage":ss(e),n();break;case"dlTrackInputTranslationInjection":Kr(e.payload),n();break;case"dlTrackExtensionOpenedEvent":Xr(e.payload),n();break;case"dlTrackLogoClickedEvent":$r(e.payload),n();break;case"dlTrackDocTransClick":Yr(),n();break;case"dlTrackRecommendToAFriendClick":Zr(),n();break;case"dlSendNotification":To(e.payload),n();break;case"dlCheckCommandShortcuts":yo().then((e=>n(e)));break;case"dlTrackUseOfShortcut":fo(e.payload),n();break;case"dlTrackUiAction":Eo(e.payload),n();break;case"dlTrackInlineSettingOpened":zr(e.payload),n();break;case"dlTrackSettingChanged":Jr(e.payload),n();break;case"dlTrackUILocationClicked":Go(e.payload),n();break;case"dlTrackRightClick":Qr(e.payload),n();break;case"dlTrackInlinePositionChange":eo(e.payload),n();break;case"dlTrackInlineDragStart":to(),n();break;case"dlTrackFptHide":no(e.payload);break;case"dlTrackInlineCopy":ro(e.payload),n();break;case"dlTrackInlineListen":so(e.payload),n();break;case"dlTrackIconHover":ao(e.payload),n();break;case"dlTrackVoiceOverStops":co(e.payload),n();break;case"dlTrackOnboardingStepChange":oo(e.payload),n();break;case"dlTrackOnboardingOpenExternalLink":io(e.payload),n();break;case"dlTrackReadMore":lo(e.payload),n();break;case"dlTrackLandingOnWebsite":Lo(e.payload),n();break;case"dlTrackGDocsReplaceText":go(e.payload),n();break;case"dlGetExperiments":uo(e.payload?.forceFetch).then((e=>n(e))).catch((e=>n(e)));break;case"dlGetClientState":Ko(e.payload?.forceFetch).then((e=>n(e))).catch((e=>n(e)));break;case"dlTextToSpeech":Io(e.payload,t.tab.id).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlGetDictionary":Ro(e.payload).then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlGetSupportedVoices":So(e.payload).then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlStopSpeech":Co(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackOpenInputHighlighter":Ao(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackOpenInlineHighlighter":Do(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackCloseInputHighlighter":No(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackCloseInlineHighlighter":ko(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackDictionaryStatus":bo(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackOpenDictionarySection":Oo(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackDisabledDictionaryHover":Po(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackZendeskCustomizationEvent":vo(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackDeeplWriteEvent":Wo(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackLingueeErrorData":xo(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackGdocsMaxCharExceededShown":Uo(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackGDocsMaxCharExceededTryProClicked":Fo(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackOnboardingModalShown":Mo(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlRequestImproveWriting":Vo(e).then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlTrackTranslateAcceptOrRevertEvent":Ho(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackCustomizationEnabledEvent":Bo(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlTrackGmailCharLimitReached":qo(e.payload).then((()=>n())).catch((e=>{n(jt(e))}));break;case"dlGetUsersCharacterLimit":Xo().then((e=>n(e))).catch((e=>{n(jt(e))}));break;case"dlTrackUpgradeNotificationIsDisplayed":$o(e.payload.type);break;case"dlTrackUpgradeNotificationClosed":Yo(e.payload.type);break;case"dlTrackUpgradeNotificationAction":Zo(e.payload.type,e.payload.cta)}return!0}function ls(e){switch(console.log(`Command "${e}" triggered`),e){case Q:chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"dlTriggerTranslationShortcut"})}));break;case ee:chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"dlChangeLanguageShortcut"})}))}}function gs(e){try{Ko(!0),chrome.runtime.setUninstallURL("https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU"),e.reason===chrome.runtime.OnInstalledReason.UPDATE&&console.log(`Update from version ${e.previousVersion} to ${chrome.runtime.getManifest().version} was completed`),async function(){let e=!1;const t=await chrome.storage.sync.get(null),a={settingSchemeVersion:2.5,blacklistDomains:[],blacklistDomainsForReading:[],blacklistDomainsForWriting:[],languagesForTranslation:o.reduce(((e,t)=>({...e,[t.langCode]:s})),{}),selectedTargetLanguage:wt(),isTargetLanguageConfirmed:!1,deepLProApiKey:{IS_PROD:!0,BASE_URLS:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.10.1",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.10.1",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.10.1",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.10.1",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",deeplPro:"https://www.deepl.com/pro",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW"},APP_VERSION:"1.10.1",FEATURE_FLAGS:{TRANSLATE_INPUT:!0,PAGE_TRANSLATION:!0,IMPROVE_WRITING:!0,DOCUMENT_TRANSLATION:!0,RECOMMEND_TO_A_FRIEND:!0,PRO_LOGIN:!0,WEBPAGE_CUSTOMIZER:!0,GDOCS_INTEGRATION:!0,ZENDESK_INTEGRATION:!0,GMAIL_INTEGRATION:!0,ON_INSTALL_ONBOARDING:!0,WHATSAPP_TRANSLATE_ALL_CHAT:!1,DEEPL_WRITE_GENERAL:!1,DEEPL_WRITE_GDOCS:!0}}.DEEPL_PRO_API_KEY,installationId:n(),enableFullPageTranslation:!0,enableInputTranslation:!0,enableInlineTranslation:!0,languagePreferenceForWriting:Lt(),languagePreferenceForReading:Lt(),blacklistedPopupWidgets:[],successfulTranslations:0,isReviewPopupShown:!1,shouldDisplayFeedbackPopup:!1,isInputHighlighterShown:!1,isInlineHighlighterShown:!1,regionalVariant:void 0,isSurveyLinkHidden:!1,isZendeskOnboarded:!1,isZendeskEnabled:!0,isZendeskOnboardingShown:!1,zendeskFormality:"auto",isGDocsOnboardingShown:!1,isGmailEnabled:!0,wasGmailOnboardingShown:!1,successfulTranslationsGmail:0,wasGmailFeedbackPopupShown:!1};if(!t||!t.settingSchemeVersion||t.settingSchemeVersion<a.settingSchemeVersion){let n={};for(const[r,o]of Object.entries(a))r in t&&"settingSchemeVersion"!==r?n[r]=t[r]:("installationId"===r&&(e=!0),n[r]=o);await chrome.storage.sync.clear(),await chrome.storage.sync.set(n),console.log("settings set: ",n)}return{installationIdWasSet:e}}().then((t=>{!async function(e,t){const n=await rr();n||e!==chrome.runtime.OnInstalledReason.INSTALL?n||await ar():(await ar(),oa(),La());t&&wa()}(e.reason,t.installationIdWasSet)})),e.reason===chrome.runtime.OnInstalledReason.INSTALL&&Ct()!==St&&ss({payload:{destination:Qo.onboarding}}),chrome.contextMenus.removeAll((function(){chrome.contextMenus.create({type:"normal",id:"dlChangeLanguageShortcut",title:chrome.i18n.getMessage("extension_settings_keyboard_shortcut_change_language"),checked:!1,contexts:["all"]},(function(){})),chrome.contextMenus.create({type:"normal",id:"dlTranslateInline",title:chrome.i18n.getMessage("context_menus_translate_section"),checked:!1,contexts:["all"]})})),chrome.tabs.query({},(function(e){for(const t of e)Jo(t)&&chrome.scripting.executeScript({target:{tabId:t},files:["build/content.js"]})}));try{uo(!0),async function(){await chrome.alarms.clearAll(),await chrome.alarms.create(zo.syncExperiments,{delayInMinutes:10,periodInMinutes:10}),await chrome.alarms.create(zo.syncClientState,{delayInMinutes:30,periodInMinutes:30})}()}catch(e){console.error(e)}}catch(e){Dn({errorCode:vt,errorMessage:e.message})}}function ds(e){switch(e.name){case zo.syncExperiments:uo();break;case zo.syncClientState:Ko()}}function us(e){switch(e.menuItemId){case"dlTranslateInline":wo(!1);break;case"dlChangeLanguageShortcut":wo(!0)}}function ps(){}const hs={setBrowserExtensionUserAgent:{type:"modifyHeaders",requestHeaders:[{header:"user-agent",operation:"set",value:`DeepLBrowserExtension/1.10.1 ${navigator.userAgent} `}]}},ms={lingueeDomainFilter:{excludedDomains:["linguee.com"],urlFilter:"*://www-app.linguee.com*",resourceTypes:["xmlhttprequest"]},deeplToolingApiDomainFilter:{excludedDomains:["deepl.com"],urlFilter:"*://*.deepl.com/jsonrpc?client=chrome-extension,*",resourceTypes:["xmlhttprequest"]},deeplStatisticsDomainFilter:{excludedDomains:["deepl.com"],urlFilter:"*://s.deepl.*/chrome/statistics*",resourceTypes:["xmlhttprequest"]}};function Ts(){chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[2,3,4],addRules:[{id:2,priority:1,action:hs.setBrowserExtensionUserAgent,condition:ms.lingueeDomainFilter},{id:3,priority:1,action:hs.setBrowserExtensionUserAgent,condition:ms.deeplToolingApiDomainFilter},{id:4,priority:1,action:hs.setBrowserExtensionUserAgent,condition:ms.deeplStatisticsDomainFilter}]},(async e=>{await console.log("created",e)}))}return Ts(),chrome.runtime.onInstalled.addListener(gs),chrome.contextMenus.onClicked.addListener(us),chrome.tabs.onActivated.addListener((async function(e){Jo((await chrome.tabs.get(e.tabId)).url)&&chrome.tabs.sendMessage(e.tabId,{action:"dlTabChanged"}),chrome.tabs.query({},(function(t){for(var n=0;n<t.length;++n)chrome.tabs.sendMessage(t[n].id,{action:"dlChangeActiveTabStatus",payload:{isActive:t[n].id===e.tabId}})})),Ko()})),chrome.runtime.onConnect.addListener((e=>{At()&&console.log(`port connected to tab with id: ${e.sender.tab.id}`)})),chrome.runtime.onMessage.addListener(is),chrome.storage.onChanged.addListener(ps),chrome.commands.onCommand.addListener(ls),chrome.alarms.onAlarm.addListener(ds),self.addEventListener("error",(function(e){Dt(e.message)})),e.INTERNAL_PAGE_KEYS=Qo,e.PERODIC_CODE_EXECUTION_NAMES=zo,e.URL_ACTIONS=ht,e.URL_LIST=mt,e.cacheClientState=Fa,e.cacheExperiments=Ga,e.checkCommandShortcuts=yo,e.clearLoginTimestamp=Qa,e.commandListener=ls,e.connectDatabase=va,e.deleteAuthTokens=Ka,e.fetchClientState=Ar,e.fetchExperiments=lr,e.getAccountID=or,e.getAuthTokens=Xa,e.getBrowserInstanceId=rr,e.getCachedClientState=Ma,e.getCachedExperiments=Va,e.getCharacterLimit=ir,e.getClientState=Ko,e.getCurrentExperiments=Wa,e.getDapApiConfig=qt,e.getDapApiExtensionOpenedFromId=$t,e.getDapApiInlinePositionType=nn,e.getDapApiLingueeError=Xt,e.getDapApiLogoClickedFromId=Yt,e.getDapApiNotificationType=Zt,e.getDapApiSettingType=tn,e.getDapApiShortcutTypes=Jt,e.getDapApiTranslationTriggerId=Kt,e.getDapApiUiActionEventId=Qt,e.getDapApiUiFunctionality=en,e.getDapApiUiLocation=zt,e.getDapGmailActionType=hn,e.getDapLogoutTrigger=gn,e.getDapNicheIntegration=cn,e.getDapOnboardingExternalLink=an,e.getDapOnboardingStepChangeTrigger=rn,e.getDapOriginStore=on,e.getDapServiceLevel=pn,e.getDapSessionTypeTrigger=dn,e.getDapUpgradeNotificationAction=Tn,e.getDapUpgradeNotificationType=mn,e.getDapWhatsAppTranslator=un,e.getDictionary=Ro,e.getExperiments=uo,e.getExperimentsData=sr,e.getExternalUrl=Tt,e.getInstallationId=za,e.getSecondsSinceLastLogin=er,e.getSessionType=Za,e.getSettings=Ha,e.getSupportedVoices=So,e.getUserInfo=nr,e.getUserState=mo,e.getUserType=cr,e.getUsersCharacterLimit=Xo,e.getWebsiteIdFromWebsite=sn,e.handleSuccessfulGmailTranslationsCount=jo,e.improveWriting=Vo,e.isPayloadNecessaryForUIEvent=ln,e.isProUser=Ya,e.isUserLoggedIn=$a,e.jsonrpc_callFunction=Rr,e.jsonrpc_composeMethodCallDict=Cr,e.listenToPerodicCodeExecution=ds,e.login=Dr,e.loginRequest=po,e.logout=Nr,e.logoutRequest=ho,e.markLoginTimestamp=Ja,e.messageListener=is,e.onContextMenuClicked=us,e.onInstalled=gs,e.onStorageChanged=ps,e.openInternalPage=ss,e.readData=Ua,e.redirectToExternalURL=yt,e.requestDictionary=Pr,e.sendDAPBrowserInstanceIdCreated=La,e.sendDAPCloseInlineHighlighter=ca,e.sendDAPCloseInputHighlighter=aa,e.sendDAPContentScriptErrorData=kn,e.sendDAPCustomizationEnabled=Da,e.sendDAPDeeplWriteEvent=_a,e.sendDAPDetectLanguage=Wn,e.sendDAPDictionaryStatus=ia,e.sendDAPDisabledDictionaryHover=ga,e.sendDAPDocTransClick=Un,e.sendDAPErrorData=Dn,e.sendDAPExtensionOpened=bn,e.sendDAPFPTHide=Xn,e.sendDAPFTPBlockSizeExceeded=async function(e){return Cn((t=>({...t,eventId:60006,fptBlockSizeExceededData:{translationData:{sourceLang:e.websiteLanguage,targetLang:e.targetLanguage,sourceLength:e.characterCount},domainName:e.domainName}})))},e.sendDAPGDocsMaxCharExceededShown=ma,e.sendDAPGDocsMaxCharExceededTryProClicked=Ta,e.sendDAPGDocsReplaceText=ra,e.sendDAPGmailCharLimitReached=Na,e.sendDAPIconHover=Zn,e.sendDAPInlineCopy=$n,e.sendDAPInlineDragStart=Bn,e.sendDAPInlineListen=Yn,e.sendDAPInlinePositionChange=Hn,e.sendDAPInlineSettingOpened=Mn,e.sendDAPInputTranslationInjection=Rn,e.sendDAPInstallSuccess=oa,e.sendDAPInstallationIdCreated=wa,e.sendDAPLandingOnSpecificWebsite=ea,e.sendDAPLingueeErrorData=da,e.sendDAPLoggedIn=Sa,e.sendDAPLoggedOut=Ca,e.sendDAPLogin=pa,e.sendDAPLogoClicked=On,e.sendDAPLogout=ha,e.sendDAPNotificationViewed=Pn,e.sendDAPOnboardingModalShown=fa,e.sendDAPOnboardingOpenExternalPage=Jn,e.sendDAPOnboardingStepChange=zn,e.sendDAPOpenDictionarySection=la,e.sendDAPOpenInlineHighlighter=sa,e.sendDAPOpenInputHighlighter=na,e.sendDAPReadMoreClicked=Qn,e.sendDAPRecommendToAFriendClick=Fn,e.sendDAPRightClick=Vn,e.sendDAPSessionStarted=Ia,e.sendDAPSettingsChanged=Gn,e.sendDAPShortcutUsed=vn,e.sendDAPTrackUpgradeNotificationAction=ba,e.sendDAPTrackUpgradeNotificationClosed=Ra,e.sendDAPTrackUpgradeNotificationDisplayed=ka,e.sendDAPTranslateAcceptOrUndoEvent=Aa,e.sendDAPTranslationErrorData=Nn,e.sendDAPTranslationRequest=An,e.sendDAPTwitterTweetTranslationFailed=Kn,e.sendDAPUILocationClicked=Ea,e.sendDAPUiAction=xn,e.sendDAPVoiceOverStops=ta,e.sendDAPWhatsAppMessageTranslated=jn,e.sendDAPWhatsAppMessageTranslationFailed=qn,e.sendDAPZendeskCustomizationEvent=ua,e.sendDAPtrackSessionType=ya,e.sendNotification=To,e.setAuthTokens=qa,e.setBrowserInstanceId=ar,e.setUserInfoFromClientState=tr,e.stopSpeech=Co,e.textToSpeech=Io,e.trackCloseInlineHighlighter=ko,e.trackCloseInputHighlighter=No,e.trackCustomizationEnabled=Bo,e.trackDeeplWriteEvent=Wo,e.trackDetectLanguage=qr,e.trackDictionaryStatus=bo,e.trackDisabledDictionaryHover=Po,e.trackDocTransClick=Yr,e.trackExtensionOpenedEvent=Xr,e.trackFptHide=no,e.trackGDocsMaxCharExceededTryProClicked=Fo,e.trackGDocsReplaceText=go,e.trackGdocsMaxCharExceededShown=Uo,e.trackGmailCharLimitReached=qo,e.trackIconHover=ao,e.trackInlineCopy=ro,e.trackInlineDragStart=to,e.trackInlineListen=so,e.trackInlinePositionChange=eo,e.trackInlineSettingsOpened=zr,e.trackInputTranslationInjection=Kr,e.trackLandingOnWebsite=Lo,e.trackLingueeErrorData=xo,e.trackLogoClickedEvent=$r,e.trackOnboardingModalShown=Mo,e.trackOnboardingOpenExternalLink=io,e.trackOnboardingStepChange=oo,e.trackOpenDictionarySection=Oo,e.trackOpenInlineHighlighter=Do,e.trackOpenInputHighlighter=Ao,e.trackReadMoreClick=lo,e.trackRecommendToAFriendClick=Zr,e.trackRightClick=Qr,e.trackSettingChanged=Jr,e.trackTranslateAcceptOrUndoEvent=Ho,e.trackUILocationClicked=Go,e.trackUiAction=Eo,e.trackUpgradeNotificationAction=Zo,e.trackUpgradeNotificationClosed=Yo,e.trackUpgradeNotificationDisplayed=$o,e.trackUseOfShortcut=fo,e.trackVoiceOverStops=co,e.trackZendeskCustomizationEvent=vo,e.translate=br,e.translateGmailReceivedEmail=Wr,e.translateHtmlRequest=Fr,e.translateInlineRequest=Mr,e.translateInputRequest=Gr,e.translateSelection=wo,e.translateTwitterTweetRequest=Vr,e.translateWhatsAppMessageRequest=Hr,e.translateWhatsAppMessagesRequest=Br,e.translateZendeskMessageRequest=jr,e.triggerTranslateInline=Ur,e.updateDynamicRules=Ts,e.updateSession=ja,e.writeData=xa,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=background.js.map
